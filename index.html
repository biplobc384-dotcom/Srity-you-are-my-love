<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡ßÉ‡¶§‡¶ø ‡¶§‡ßÅ‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; overflow: hidden; background: #020617; color: white; user-select: none; }
        
        /* ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° */
        .bg-base { 
            background: linear-gradient(-45deg, #0f172a, #312e81, #581c87, #4c0519);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            position: relative;
            transition: filter 1s ease;
        }
        .bg-sad { filter: grayscale(0.8) brightness(0.7); }
        .bg-angry { filter: sepia(0.5) hue-rotate(-50deg) saturate(3); animation: shake 0.5s infinite; }
        
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        /* ‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø‡¶∞ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
        .rain { position: absolute; left: 0; width: 1px; height: 100px; background: linear-gradient(transparent, #a5b4fc); opacity: 0.7; animation: rain-fall linear infinite; display: none; z-index: 1; }
        @keyframes rain-fall { 0% { transform: translateY(-100px); } 100% { transform: translateY(100vh); } }

        /* ‡¶∏‡¶ø‡¶® ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡¶ø‡¶∂‡¶® */
        .scene { display: none; width: 100%; height: 100vh; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: absolute; top: 0; left: 0; z-index: 20; overflow-y: auto; overflow-x: hidden; }
        .scene.active { display: flex; animation: fadeIn 0.8s cubic-bezier(0.23, 1, 0.32, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .glass-card { background: rgba(0, 0, 0, 0.65); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 2rem; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); }
        
        .btn-primary { background: linear-gradient(to right, #db2777, #e11d48); padding: 12px 28px; border-radius: 9999px; font-weight: bold; transition: all 0.3s; color: white; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(219, 39, 119, 0.4); }
        .btn-primary:active { transform: scale(0.95); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(219, 39, 119, 0.6); }

        /* ‡¶´‡ßç‡¶≤‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ú‡¶® */
        #bubbles-container { position: fixed; inset: 0; pointer-events: none; z-index: 10; overflow: hidden; }
        .reason-bubble { 
            position: absolute; 
            bottom: -60px; 
            background: rgba(255, 255, 255, 0.15); 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            padding: 10px 20px; 
            border-radius: 20px; 
            font-size: 14px; 
            color: #fff; 
            cursor: pointer; 
            pointer-events: auto;
            backdrop-filter: blur(4px);
            white-space: nowrap;
            animation: floatUp linear forwards; 
        }
        @keyframes floatUp { 
            0% { transform: translateY(0) scale(0.8); opacity: 0; } 
            10% { opacity: 1; } 
            90% { opacity: 1; } 
            100% { transform: translateY(-110vh) scale(1.1); opacity: 0; } 
        }

        /* ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡¶æ‡¶∞‡ßç‡¶° (New Feature) */
        .scratch-container { position: relative; width: 300px; height: 150px; border-radius: 15px; overflow: hidden; margin: 20px auto; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .scratch-content { position: absolute; inset: 0; background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; color: #db2777; font-weight: bold; font-size: 1.2rem; text-align: center; padding: 10px; z-index: 1; }
        #scratch-canvas { position: absolute; inset: 0; z-index: 2; cursor: grab; }

        /* ‡¶≤‡¶æ‡¶≠ ‡¶≤‡ßá‡¶ü‡¶æ‡¶∞ */
        .envelope-wrapper { position: relative; width: 280px; height: 180px; cursor: pointer; margin-bottom: 2rem; perspective: 1000px; }
        .envelope { position: relative; width: 100%; height: 100%; background: #f472b6; border-radius: 0 0 10px 10px; z-index: 10; transform-style: preserve-3d; transition: transform 0.6s; }
        .envelope::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #be185d; clip-path: polygon(0 0, 50% 50%, 100% 0); z-index: 20; transform-origin: top; transition: transform 0.6s 0.4s; }
        .letter { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 90%; height: 90%; background: white; border-radius: 5px; padding: 15px; z-index: 5; transition: bottom 0.6s 0.8s, z-index 0s 0.8s; color: #333; text-align: center; font-size: 14px; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .envelope-wrapper.open .envelope::before { transform: rotateX(180deg); z-index: 1; }
        .envelope-wrapper.open .letter { bottom: 100px; z-index: 25; }

        /* ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ */
        .scan-anim { animation: scan 1.5s linear infinite; }
        @keyframes scan { 0% { top: 0; opacity: 0.5; box-shadow: 0 0 5px #ec4899; } 50% { top: 100%; opacity: 1; box-shadow: 0 0 20px #ec4899; } 100% { top: 0; opacity: 0.5; box-shadow: 0 0 5px #ec4899; } }
        .fingerprint-icon { transition: all 0.3s; }
        .scanning .fingerprint-icon { color: #f472b6; transform: scale(1.05); }

        /* ‡¶ï‡¶ø‡¶∏ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï */
        .kiss-mark { position: absolute; font-size: 3rem; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); user-select: none; pointer-events: none; transform: rotate(var(--r)); z-index: 100; filter: drop-shadow(0 0 5px rgba(255,0,0,0.5)); }
        @keyframes popIn { 0% { transform: scale(0) rotate(var(--r)); opacity: 0; } 100% { transform: scale(1) rotate(var(--r)); opacity: 0.8; } }

        /* ‡¶ü‡¶æ‡¶á‡¶Æ‡¶≤‡¶æ‡¶á‡¶® */
        .timeline-item { position: relative; padding-left: 30px; margin-bottom: 25px; border-left: 2px solid rgba(255,255,255,0.2); cursor: pointer; }
        .timeline-dot { position: absolute; left: -6px; top: 0; width: 10px; height: 10px; background: #ec4899; border-radius: 50%; box-shadow: 0 0 10px #ec4899; transition: 0.3s; }
        .timeline-content { opacity: 0.5; transition: 0.3s; transform: translateX(-10px); }
        .timeline-item:hover .timeline-dot { transform: scale(1.5); background: #fff; }
        .timeline-item:hover .timeline-content { opacity: 1; transform: translateX(0); }
        .timeline-item.active .timeline-content { opacity: 1; transform: translateX(0); }

        .runaway-btn { position: absolute; transition: all 0.2s ease; }
        .heartbeat-circle { width: 100px; height: 100px; background: radial-gradient(circle, #ff0055 0%, transparent 70%); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); opacity: 0; pointer-events: none; }
        .beat-anim { animation: beatWave 0.6s ease-out; }
        @keyframes beatWave { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(3); opacity: 0; } }
    </style>
</head>
<body id="main-body" class="bg-base" onmousemove="createDust(event)" oncontextmenu="return false">

    <div id="rain-container"></div>
    <div id="bubbles-container"></div>

    <div id="top-bar" class="fixed top-6 left-1/2 -translate-x-1/2 z-20 text-center w-full hidden">
        <div class="glass-card px-6 py-2 inline-block border-pink-500/30 rounded-full">
            <p id="relationship-timer" class="text-xs md:text-sm font-bold text-pink-200 tracking-wide font-mono"></p>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßß: ‡¶∂‡ßÅ‡¶∞‡ßÅ -->
    <div id="scene-0" class="scene active">
        <div onclick="startJourney()" class="cursor-pointer group relative">
            <div class="absolute -inset-10 bg-pink-600 rounded-full blur-3xl opacity-30 group-hover:opacity-60 transition duration-1000"></div>
            <div class="w-48 h-48 glass-card rounded-full flex items-center justify-center border-2 border-pink-500/50 group-hover:scale-110 transition-transform relative z-10">
                <i data-lucide="heart" class="text-pink-500 w-24 h-24 animate-pulse fill-current"></i>
            </div>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mt-10 text-white drop-shadow-lg text-center px-4">‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã ‡¶∏‡ßç‡¶Æ‡ßÉ‡¶§‡¶ø ‚ù§Ô∏è</h1>
        <p class="mt-4 text-pink-200 animate-bounce uppercase tracking-widest text-xs font-semibold">‡¶ü‡¶æ‡¶ö ‡¶ï‡¶∞‡ßã</p>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ß®: ‡¶Æ‡ßÅ‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® -->
    <div id="scene-mood" class="scene">
        <div class="glass-card p-8 text-center max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-6 text-white">‡¶Ü‡¶ú ‡¶§‡ßã‡¶∞ ‡¶Æ‡¶® ‡¶ï‡ßá‡¶Æ‡¶®? ‚ú®</h2>
            <div class="flex gap-4 justify-center mb-6">
                <button onclick="setWeather('happy')" class="glass-card p-4 text-4xl hover:bg-pink-500/30 transition-all">üòä</button>
                <button onclick="setWeather('sad')" class="glass-card p-4 text-4xl hover:bg-blue-500/30 transition-all">üòî</button>
                <button onclick="setWeather('angry')" class="glass-card p-4 text-4xl hover:bg-red-500/30 transition-all">üò§</button>
            </div>
            <p id="mood-msg" class="text-lg font-medium text-pink-300 min-h-[30px]"></p>
            <button id="mood-next" onclick="nextScene('calculator')" class="hidden mt-6 btn-primary w-full">‡¶™‡¶∞‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™‡ßá ‡¶ö‡¶≤‡ßã</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ß©: ‡¶≤‡¶æ‡¶≠ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞ -->
    <div id="scene-calculator" class="scene">
        <div class="glass-card p-8 w-full max-w-md mx-4 text-center">
            <h2 class="text-2xl font-bold mb-4 text-purple-300">‡¶≤‡¶æ‡¶≠ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞ üíò</h2>
            <div class="flex justify-between items-center mb-4 px-4 font-bold text-lg">
                <span>‡¶Ü‡¶Æ‡¶ø</span>
                <i data-lucide="heart" class="text-red-500 fill-current w-6 h-6 animate-pulse"></i>
                <span>‡¶∏‡ßç‡¶Æ‡ßÉ‡¶§‡¶ø</span>
            </div>
            <div class="meter-container" style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 20px; overflow: hidden; margin: 20px 0;">
                <div id="love-fill" style="height: 100%; background: linear-gradient(90deg, #ec4899, #8b5cf6); width: 0%; transition: width 0.1s;"></div>
            </div>
            <h1 id="love-percent" class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-500 h-16">0%</h1>
            <p id="love-result" class="text-sm text-gray-300 mt-2 min-h-[20px]"></p>
            <button onclick="calculateLove()" class="btn-primary w-full mt-6">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶™ ‡¶ï‡¶∞‡ßã</button>
            <button id="calc-next" onclick="nextScene('reasons')" class="btn-primary w-full mt-4 hidden bg-gradient-to-r from-green-500 to-emerald-600">‡¶ï‡¶æ‡¶∞‡¶£‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßã</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ß™: ‡¶´‡ßç‡¶≤‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ú‡¶® -->
    <div id="scene-reasons" class="scene">
        <div class="z-20 text-center glass-card p-6 w-full max-w-md">
            <h2 class="text-3xl font-bold mb-2">‡¶ï‡ßá‡¶® ‡¶§‡ßã‡¶ï‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø?</h2>
            <p class="text-sm text-pink-200 mb-6">‡¶ö‡¶æ‡¶∞‡¶™‡¶æ‡¶∂‡ßá ‡¶≠‡¶æ‡¶∏‡¶Æ‡¶æ‡¶® ‡¶¨‡¶æ‡¶¨‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßã ‚ù§Ô∏è</p>
            <div class="h-32 flex items-center justify-center">
                <p class="text-xs text-gray-400 animate-pulse">(‡¶¨‡¶æ‡¶¨‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡¶ø‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶â‡¶™‡¶∞‡ßá ‡¶â‡¶†‡¶õ‡ßá...)</p>
            </div>
            <button onclick="stopReasons(); nextScene('scanner')" class="btn-primary w-full">‡¶∏‡ßã‡¶≤‡¶Æ‡ßá‡¶ü ‡¶ü‡ßá‡¶∏‡ßç‡¶ü</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ß´: ‡¶∏‡ßã‡¶≤‡¶Æ‡ßá‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ -->
    <div id="scene-scanner" class="scene">
        <div class="glass-card p-10 text-center max-w-md mx-4 w-full">
            <h2 class="text-2xl font-bold mb-6 text-pink-300">‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ï‡¶ø ‡¶∏‡ßã‡¶≤‡¶Æ‡ßá‡¶ü? üïµÔ∏è‚Äç‚ôÄÔ∏è</h2>
            <p class="text-gray-300 mb-8 text-sm">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞‡ßá ‡¶Ü‡¶ô‡ßÅ‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ö‡ßá‡¶™‡ßá ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßã...</p>
            
            <div id="scanner-btn" class="relative w-28 h-28 mx-auto mb-6 cursor-pointer select-none rounded-2xl border border-pink-500/30 p-2" 
                 onmousedown="startScan()" onmouseup="stopScan()" onmouseleave="stopScan()"
                 ontouchstart="startScan()" ontouchend="stopScan()">
                <i data-lucide="fingerprint" class="w-full h-full text-pink-500/50 fingerprint-icon"></i>
                <div id="scan-beam" class="absolute top-0 left-0 w-full h-1 bg-pink-400 shadow-[0_0_15px_#ec4899] hidden rounded-full"></div>
            </div>
            
            <p id="scan-status" class="text-lg font-bold text-white min-h-[30px]">‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ö‡¶æ‡¶™ ‡¶¶‡¶æ‡¶ì</p>
            <button id="scanner-next" onclick="nextScene('scratch')" class="btn-primary w-full mt-8 hidden animate-bounce">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶®‡¶æ‡¶ì</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ß¨: ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡¶æ‡¶∞‡ßç‡¶° (New Feature) -->
    <div id="scene-scratch" class="scene">
        <div class="glass-card p-8 w-full max-w-md mx-4 text-center">
            <h2 class="text-2xl font-bold mb-2 text-white">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‚ú®</h2>
            <p class="text-sm text-gray-300 mb-6">‡¶ó‡ßã‡¶™‡¶® ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶ò‡¶∑‡ßá ‡¶§‡ßã‡¶≤‡ßã!</p>
            
            <div class="scratch-container">
                <div class="scratch-content">
                    <p>‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶∞<br>‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ ‚ù§Ô∏è</p>
                    <i data-lucide="crown" class="mt-2 text-yellow-500"></i>
                </div>
                <canvas id="scratch-canvas"></canvas>
            </div>
            
            <button id="scratch-next" onclick="nextScene('timeline')" class="btn-primary w-full mt-6 hidden">‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶ö‡¶≤‡ßã</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ß≠: ‡¶ü‡¶æ‡¶á‡¶Æ‡¶≤‡¶æ‡¶á‡¶® -->
    <div id="scene-timeline" class="scene">
        <div class="glass-card p-8 w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold mb-6 text-center text-pink-300">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡ßé üõ§Ô∏è</h2>
            <div class="ml-4">
                <div class="timeline-item active">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <h3 class="font-bold text-lg">‡ß®‡ß¶‡ß®‡ß¨</h3>
                        <p class="text-sm text-gray-300">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ... ‚ù§Ô∏è</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <h3 class="font-bold text-lg">‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡ßé...</h3>
                        <p class="text-sm text-gray-300">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶æ‡¶§ ‡¶ß‡¶∞‡ßá ‡¶™‡ßÅ‡¶∞‡ßã ‡¶™‡ßÉ‡¶•‡¶ø‡¶¨‡ßÄ ‡¶ò‡ßÅ‡¶∞‡¶¨‡ßã‡•§ ‚úàÔ∏è</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <h3 class="font-bold text-lg">‡¶∏‡¶æ‡¶∞‡¶æ‡¶ú‡ßÄ‡¶¨‡¶®</h3>
                        <p class="text-sm text-gray-300">‡¶è‡¶ï‡¶á ‡¶õ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá, ‡¶∏‡ßÅ‡¶ñ‡ßá ‡¶¶‡ßÅ‡¶É‡¶ñ‡ßá ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá‡•§ üè°</p>
                    </div>
                </div>
            </div>
            <button onclick="nextScene('kiss')" class="btn-primary w-full mt-8">‡¶ö‡ßÅ‡¶Æ‡ßÅ ‡¶¶‡¶æ‡¶ì</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßÆ: ‡¶≠‡¶æ‡¶∞‡ßç‡¶ö‡ßÅ‡ßü‡¶æ‡¶≤ ‡¶ï‡¶ø‡¶∏ -->
    <div id="scene-kiss" class="scene">
        <div class="glass-card p-10 text-center max-w-md mx-4">
            <div class="mb-6 relative inline-block">
                <i data-lucide="lips" class="text-pink-500 w-20 h-20"></i>
                <div class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full animate-bounce">Hot</div>
            </div>
            <h2 class="text-2xl font-bold mb-4">‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶æ ‡¶ö‡ßÅ‡¶Æ‡ßÅ ‡¶¶‡¶æ‡¶ì! üíã</h2>
            <p class="text-sm text-gray-300 mb-8">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶ì</p>
            
            <button onclick="giveKiss()" class="btn-primary w-full bg-gradient-to-r from-red-500 to-pink-600 shadow-red-500/50">
                ‡¶â‡¶Æ‡ßç‡¶Æ‡¶Æ‡ßç‡¶Æ‡¶Æ‡ßç‡¶Æ‡¶æ‡¶π! üòò
            </button>
            <p id="kiss-counter" class="mt-4 text-pink-300 font-bold opacity-0">üòò 0 ‡¶ü‡¶æ ‡¶ö‡ßÅ‡¶Æ‡ßÅ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßã!</p>
            
            <button onclick="nextScene('promises')" class="mt-8 text-sm text-gray-400 hover:text-white underline">‡¶™‡¶∞‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™‡ßá ‡¶ö‡¶≤‡ßã</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßØ: ‡¶™‡ßç‡¶∞‡¶Æ‡¶ø‡¶ú -->
    <div id="scene-promises" class="scene">
        <div class="glass-card p-8 w-full max-w-md mx-4">
            <h2 class="text-2xl font-bold mb-6 text-pink-400 flex items-center justify-center gap-2">
                <i data-lucide="shield-check"></i> ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶ô‡ßç‡¶ó‡ßÄ‡¶ï‡¶æ‡¶∞
            </h2>
            <ul class="space-y-4 text-gray-100 text-left">
                <li class="glass-card p-3 flex items-center gap-3"><span class="text-pink-500">üå∏</span> I Love you jan</li>
                <li class="glass-card p-3 flex items-center gap-3"><span class="text-pink-500">üå∏</span> You are my first love</li>
                <li class="glass-card p-3 flex items-center gap-3"><span class="text-pink-500">üå∏</span> ‡¶∏‡¶æ‡¶∞‡¶æ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶è‡¶ï‡¶á‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßã‡¶ï‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡ßá‡¶∏‡ßá ‡¶Ø‡¶æ‡¶¨‡ßã‡•§</li>
            </ul>
            <button onclick="nextScene('letter')" class="btn-primary w-full mt-8">‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶ö‡¶≤‡ßã ‚ù§Ô∏è</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßß‡ß¶: ‡¶ö‡¶ø‡¶†‡¶ø -->
    <div id="scene-letter" class="scene">
        <h2 class="text-2xl font-bold mb-8 text-white animate-pulse">‡¶§‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡¶ø‡¶†‡¶ø üíå</h2>
        <div class="envelope-wrapper" onclick="openLetter(this)">
            <div class="envelope"></div>
            <div class="letter">
                <p class="text-pink-600 font-bold text-lg mb-2">‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶∏‡ßç‡¶Æ‡ßÉ‡¶§‡¶ø,</p>
                <p class="text-gray-600 text-xs leading-relaxed">
                    ‡¶§‡ßÅ‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá‡¶∞ ‡¶∏‡ßá‡¶∞‡¶æ ‡¶â‡¶™‡¶π‡¶æ‡¶∞‡•§<br>‡¶§‡ßã‡¶ï‡ßá ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶ï‡¶æ‡¶ü‡ßá ‡¶®‡¶æ‡•§<br>‡¶∏‡¶æ‡¶∞‡¶æ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶æ‡¶§‡¶ü‡¶æ ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶ø‡¶∏‡•§<br>
                    <span class="font-bold text-rose-500 block mt-2">‡¶á‡¶§‡¶ø, ‡¶§‡ßã‡¶∞ ‡¶™‡¶æ‡¶ó‡¶≤</span>
                </p>
            </div>
        </div>
        <button id="letter-next" onclick="nextScene('gallery')" class="btn-primary mt-10 opacity-0 transition-opacity duration-1000">‡¶∏‡ßç‡¶Æ‡ßÉ‡¶§‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßã</button>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßß‡ßß: ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø -->
    <div id="scene-gallery" class="scene">
        <div class="glass-card p-5 w-full max-w-sm mx-4">
            <div class="relative rounded-2xl overflow-hidden mb-5 border border-white/10 shadow-2xl h-[400px] bg-black/30">
                <img id="gallery-img" src="" class="w-full h-full object-cover transition-opacity duration-500">
                <div class="absolute bottom-0 bg-black/70 w-full p-4">
                    <p id="gallery-caption" class="text-center text-white text-sm"></p>
                </div>
            </div>
            <button onclick="nextPhoto()" class="btn-primary w-full flex items-center justify-center gap-2">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∏‡ßç‡¶Æ‡ßÉ‡¶§‡¶ø <i data-lucide="camera" size="16"></i></button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßß‡ß®: ‡¶â‡¶á‡¶∂ ‡¶¨‡ßã‡¶ü‡¶≤ -->
    <div id="scene-bottle" class="scene">
        <div class="glass-card p-8 text-center max-w-md w-full mx-4">
            <i data-lucide="container" size="48" class="text-blue-300 mx-auto mb-4"></i>
            <h2 class="text-2xl font-bold mb-3">‡¶â‡¶á‡¶∂ ‡¶¨‡ßã‡¶ü‡¶≤ üßû‚Äç‚ôÇÔ∏è</h2>
            <textarea id="wish-input" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 text-white outline-none mb-6 h-24" placeholder="‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶á‡¶ö‡ßç‡¶õ‡¶æ..."></textarea>
            <button onclick="sendWish()" class="btn-primary w-full">‡¶∏‡¶æ‡¶ó‡¶∞‡ßá ‡¶≠‡¶æ‡¶∏‡¶ø‡ßü‡ßá ‡¶¶‡¶æ‡¶ì</button>
        </div>
    </div>

    <!-- ‡¶∏‡¶ø‡¶® ‡ßß‡ß©: ‡¶∂‡ßá‡¶∑ -->
    <div id="scene-end" class="scene text-center relative overflow-hidden">
        <canvas id="confetti-canvas" class="absolute inset-0 pointer-events-none"></canvas>
        <div class="glass-card p-10 mx-4 max-w-md relative z-10">
            <h1 class="text-4xl font-black text-pink-500 mb-6">I LOVE YOU</h1>
            <p class="text-xl text-gray-100 mb-8">‡¶§‡ßÅ‡¶á ‡¶∏‡¶æ‡ßú‡¶æ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡¶ø ‡¶§‡ßã? ‚ù§Ô∏è</p>
            
            <div class="flex flex-col items-center gap-6">
                <!-- ‡¶π‡¶æ‡¶∞‡ßç‡¶ü‡¶¨‡¶ø‡¶ü -->
                <button onclick="heartbeatSync()" class="relative group">
                    <div class="heartbeat-circle" id="hb-circle"></div>
                    <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center shadow-lg shadow-red-500/50 animate-pulse">
                         <i data-lucide="heart" class="text-white fill-current"></i>
                    </div>
                    <p class="text-xs mt-2 text-pink-300">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶π‡ßÉ‡ßé‡¶∏‡ßç‡¶™‡¶®‡ßç‡¶¶‡¶®</p>
                </button>

                <div class="flex justify-center gap-4 relative w-full h-16">
                    <button onclick="finalYes()" class="btn-primary px-8">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶•‡¶æ‡¶ï‡¶¨‡ßã!</button>
                    <button id="no-btn" onmouseover="moveNoBtn()" class="bg-gray-600 text-white px-6 py-3 rounded-full font-bold absolute right-4 transition-all duration-100 runaway-btn">‡¶®‡¶æ üòú</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü -->
    <div id="custom-alert" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm hidden">
        <div class="glass-card p-6 max-w-xs text-center border-pink-500/40 transform scale-90 transition-transform duration-300" id="alert-box">
            <i data-lucide="sparkles" class="text-pink-400 mx-auto mb-4" size="32"></i>
            <p id="alert-text" class="text-lg font-medium mb-6"></p>
            <button onclick="closeAlert()" class="btn-primary w-full">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
        </div>
    </div>

    <script>
        const startDate = new Date("2026-01-01T00:00:00"); 
        const memories = [
            { url: "https://i.ibb.co/5gTRgHkw/IMG20260126100531.jpg", caption: "‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶§‡ßã‡¶≤‡¶æ ‡¶¶‡ßÅ‡¶á‡¶ú‡¶®‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‚ù§Ô∏è" },
            { url: "https://i.ibb.co/8gDV1dw6/IMG-20260120-184619-150.jpg", caption: "‡¶§‡ßã‡¶Æ‡¶æ‡ßü ‡¶®‡¶ø‡ßü‡ßá ‡¶∏‡ßç‡¶¨‡¶™‡ßç‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø" }
        ];

        // --- ‡¶∏‡¶ø‡¶® ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ---
        function startJourney() {
            document.getElementById('top-bar').classList.remove('hidden');
            nextScene('mood');
        }

        function nextScene(id) {
            document.querySelectorAll('.scene').forEach(s => {
                s.style.opacity = '0';
                setTimeout(() => s.classList.remove('active'), 300);
            });
            setTimeout(() => {
                const next = document.getElementById(`scene-${id}`);
                next.classList.add('active');
                next.style.opacity = '0';
                setTimeout(() => next.style.opacity = '1', 50);
                
                // ‡¶∏‡¶ø‡¶® ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶´‡¶ø‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
                if(id === 'gallery') updatePhoto();
                if(id === 'reasons') startFloatingReasons();
                if(id === 'scratch') initScratchCard();
                if(id === 'end') fireConfetti();
                lucide.createIcons();
            }, 300);
        }

        // --- ‡¶ì‡ßü‡ßá‡¶¶‡¶æ‡¶∞ ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü ---
        function setWeather(mood) {
            const body = document.getElementById('main-body');
            const rain = document.getElementById('rain-container');
            const msg = document.getElementById('mood-msg');
            
            body.className = 'bg-base'; 
            rain.innerHTML = ''; rain.style.display = 'none';
            document.getElementById('mood-next').classList.remove('hidden');

            if (mood === 'sad') {
                body.classList.add('bg-sad');
                rain.style.display = 'block';
                createRain();
                msg.innerText = "‡¶ï‡¶æ‡¶®‡ßç‡¶®‡¶æ ‡¶ï‡¶∞‡ßã ‡¶®‡¶æ ‡¶™‡ßç‡¶≤‡¶ø‡¶ú, ‡¶Ü‡¶ï‡¶æ‡¶∂‡¶ì ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶Å‡¶¶‡¶õ‡ßá! üåßÔ∏è";
            } else if (mood === 'angry') {
                body.classList.add('bg-angry');
                msg.innerText = "‡¶â‡¶´! ‡¶∞‡¶æ‡¶ó‡¶≤‡ßá ‡¶§‡ßã‡¶ï‡ßá ‡¶Ø‡¶æ ‡¶≤‡¶æ‡¶ó‡ßá ‡¶®‡¶æ! ‡¶Ü‡¶ó‡ßÅ‡¶®‡ßá‡¶∞ ‡¶ó‡ßã‡¶≤‡¶æ‡¶∞ ‡¶Æ‡¶§! üî•";
            } else {
                msg.innerText = "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶è‡¶á ‡¶π‡¶æ‡¶∏‡¶ø‡¶ü‡¶æ‡¶á ‡¶§‡ßã ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡ßá‡¶Å‡¶ö‡ßá ‡¶•‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£! üíñ";
            }
        }
        function createRain() {
            const container = document.getElementById('rain-container');
            for(let i=0; i<50; i++) {
                const drop = document.createElement('div');
                drop.className = 'rain';
                drop.style.left = Math.random() * 100 + 'vw';
                drop.style.animationDuration = Math.random() * 1 + 0.5 + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(drop);
            }
        }

        // --- ‡¶≤‡¶æ‡¶≠ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞ ---
        function calculateLove() {
            const fill = document.getElementById('love-fill');
            const num = document.getElementById('love-percent');
            const res = document.getElementById('love-result');
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 5;
                if(progress > 100) progress = 100;
                fill.style.width = progress + '%';
                num.innerText = Math.floor(progress) + '%';
                if(progress === 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        num.innerText = "‚àû%";
                        num.classList.add('animate-pulse');
                        res.innerText = "‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ ‡¶Æ‡¶æ‡¶™‡¶æ ‡¶Ö‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨! ‚ù§Ô∏è";
                        document.getElementById('calc-next').classList.remove('hidden');
                    }, 500);
                }
            }, 50);
        }

        // --- Floating Reasons ---
        const reasons = ["‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶π‡¶æ‡¶∏‡¶ø", "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Æ‡¶æ‡ßü‡¶æ‡¶¨‡ßÄ ‡¶ö‡ßã‡¶ñ", "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶≤‡¶§‡¶æ", "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßá‡ßü‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∏‡ßç‡¶¨‡¶≠‡¶æ‡¶¨", "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ó‡¶≤‡¶æ‡¶Æ‡¶ø", "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶¨ ‡¶ï‡¶•‡¶æ ‡¶∂‡ßã‡¶®‡¶æ", "‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶™‡¶æ‡¶∂‡ßá ‡¶•‡¶æ‡¶ï‡¶æ"];
        let reasonInterval;

        function startFloatingReasons() {
            const container = document.getElementById('bubbles-container');
            container.innerHTML = ''; 
            
            reasonInterval = setInterval(() => {
                if(!document.getElementById('scene-reasons').classList.contains('active')) return;
                const bubble = document.createElement('div');
                bubble.className = 'reason-bubble';
                bubble.innerText = reasons[Math.floor(Math.random() * reasons.length)];
                bubble.style.left = Math.random() * 80 + 10 + 'vw';
                const scale = Math.random() * 0.4 + 0.8;
                bubble.style.transform = `scale(${scale})`;
                const duration = Math.random() * 3 + 5;
                bubble.style.animationDuration = duration + 's';

                container.appendChild(bubble);

                bubble.onclick = function() { 
                    this.style.background = '#ec4899'; 
                    this.style.zIndex = 100;
                    this.innerText = "‚ù§Ô∏è I Love You";
                    showAlert("‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶ï‡ßá ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶Ö‡¶®‡ßá‡¶ï ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø! ‚ù§Ô∏è");
                }
                setTimeout(() => bubble.remove(), duration * 1000);
            }, 800);
        }

        function stopReasons() {
            clearInterval(reasonInterval);
            document.getElementById('bubbles-container').innerHTML = '';
        }

        // --- ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ---
        let scanTimer;
        let isScanning = false;

        function startScan() {
            if(isScanning) return;
            isScanning = true;
            
            const beam = document.getElementById('scan-beam');
            const status = document.getElementById('scan-status');
            const btn = document.getElementById('scanner-btn');
            
            beam.classList.remove('hidden');
            beam.classList.add('scan-anim');
            btn.classList.add('scanning');
            status.innerText = "‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... (‡¶ö‡ßá‡¶™‡ßá ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßã)";
            
            scanTimer = setTimeout(() => {
                beam.classList.remove('scan-anim');
                beam.classList.add('hidden');
                btn.classList.remove('scanning');
                
                status.innerHTML = "‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶°! <span class='text-green-400'>‡ßß‡ß¶‡ß¶% ‡¶∏‡ßã‡¶≤‡¶Æ‡ßá‡¶ü! ‚ù§Ô∏è</span>";
                document.getElementById('scanner-next').classList.remove('hidden');
                fireConfetti();
                
                if (navigator.vibrate) navigator.vibrate([100, 50, 200]);
            }, 2500); 
        }

        function stopScan() {
            if(!isScanning) return;
            if(document.getElementById('scanner-next').classList.contains('hidden')) {
                clearTimeout(scanTimer);
                isScanning = false;
                
                const beam = document.getElementById('scan-beam');
                const btn = document.getElementById('scanner-btn');
                const status = document.getElementById('scan-status');

                beam.classList.remove('scan-anim');
                beam.classList.add('hidden');
                btn.classList.remove('scanning');
                status.innerText = "‡¶õ‡ßá‡ßú‡ßá ‡¶¶‡¶ø‡¶≤‡ßá ‡¶ï‡ßá‡¶®? ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶™‡ßá ‡¶ß‡¶∞‡ßã!";
            }
        }

        // --- ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ú‡¶ø‡¶ï (New Feature) ---
        function initScratchCard() {
            const canvas = document.getElementById('scratch-canvas');
            const ctx = canvas.getContext('2d');
            const container = document.querySelector('.scratch-container');
            
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            // Fill with silver color
            ctx.fillStyle = "#C0C0C0"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add text or glitter text on top
            ctx.font = "20px Arial";
            ctx.fillStyle = "#888";
            ctx.fillText("‡¶ò‡¶∑‡ßá ‡¶¶‡ßá‡¶ñ‡ßã", canvas.width/2 - 40, canvas.height/2);

            let isDrawing = false;

            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: (e.clientX || e.touches[0].clientX) - rect.left,
                    y: (e.clientY || e.touches[0].clientY) - rect.top
                };
            }

            function scratch(x, y) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                checkScratchCompletion();
            }

            canvas.addEventListener('mousedown', (e) => { isDrawing = true; scratch(getMousePos(e).x, getMousePos(e).y); });
            canvas.addEventListener('mousemove', (e) => { if (isDrawing) scratch(getMousePos(e).x, getMousePos(e).y); });
            canvas.addEventListener('mouseup', () => isDrawing = false);
            
            canvas.addEventListener('touchstart', (e) => { isDrawing = true; scratch(getMousePos(e).x, getMousePos(e).y); e.preventDefault(); });
            canvas.addEventListener('touchmove', (e) => { if (isDrawing) scratch(getMousePos(e).x, getMousePos(e).y); e.preventDefault(); });
            canvas.addEventListener('touchend', () => isDrawing = false);

            function checkScratchCompletion() {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const pixels = imageData.data;
                let transparentPixels = 0;
                for (let i = 3; i < pixels.length; i += 4) {
                    if (pixels[i] === 0) transparentPixels++;
                }
                const percentage = (transparentPixels / (pixels.length / 4)) * 100;
                
                if (percentage > 40) { // 40% cleared
                    canvas.style.transition = "opacity 1s";
                    canvas.style.opacity = "0";
                    setTimeout(() => {
                         canvas.style.display = "none";
                         document.getElementById('scratch-next').classList.remove('hidden');
                    }, 1000);
                }
            }
        }

        // --- Virtual Kiss ---
        let kissCount = 0;
        function giveKiss() {
            kissCount++;
            document.getElementById('kiss-counter').innerText = `üòò ${kissCount} ‡¶ü‡¶æ ‡¶ö‡ßÅ‡¶Æ‡ßÅ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßã!`;
            document.getElementById('kiss-counter').style.opacity = '1';

            const mark = document.createElement('div');
            mark.className = 'kiss-mark';
            mark.innerHTML = 'üíã';
            const x = Math.random() * (window.innerWidth - 50);
            const y = Math.random() * (window.innerHeight - 50);
            const rot = Math.random() * 60 - 30;

            mark.style.left = x + 'px';
            mark.style.top = y + 'px';
            mark.style.setProperty('--r', rot + 'deg');

            document.getElementById('scene-kiss').appendChild(mark);
            if (navigator.vibrate) navigator.vibrate(50);
            setTimeout(() => mark.remove(), 2000);
        }

        // --- Heartbeat ---
        function heartbeatSync() {
            const circle = document.getElementById('hb-circle');
            circle.classList.remove('beat-anim');
            void circle.offsetWidth; 
            circle.classList.add('beat-anim');
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
        }

        // --- Runaway Button ---
        function moveNoBtn() {
            const btn = document.getElementById('no-btn');
            const container = document.querySelector('#scene-end .glass-card');
            const rect = container.getBoundingClientRect();
            const newX = (Math.random() * (rect.width - 100));
            const newY = (Math.random() * (rect.height - 50));
            btn.style.position = 'absolute';
            btn.style.left = Math.abs(newX) + 'px';
            btn.style.top = Math.abs(newY) + 'px';
        }

        function finalYes() {
            fireConfetti();
            showAlert("‡¶Ü‡¶Æ‡¶ø ‡¶ú‡¶æ‡¶®‡¶§‡¶æ‡¶Æ ‡¶§‡ßÅ‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶õ‡¶æ‡ßú‡¶æ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡¶ø ‡¶®‡¶æ! ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø ‡¶§‡ßã‡¶ï‡ßá! ‚ù§Ô∏èü•∞");
            setTimeout(() => location.reload(), 4000);
        }

        // --- Gallery, Letter, Wish ---
        let photoIdx = 0;
        function updatePhoto() {
            const img = document.getElementById('gallery-img');
            img.style.opacity = '0';
            setTimeout(() => {
                img.src = memories[photoIdx].url;
                document.getElementById('gallery-caption').innerText = memories[photoIdx].caption;
                img.onload = () => img.style.opacity = '1';
            }, 200);
        }
        function nextPhoto() {
            if(photoIdx < memories.length - 1) { photoIdx++; updatePhoto(); } 
            else { nextScene('bottle'); }
        }

        function openLetter(el) {
            if(!el.classList.contains('open')) {
                el.classList.add('open');
                setTimeout(() => document.getElementById('letter-next').classList.remove('opacity-0'), 1500);
            }
        }

        function sendWish() {
            const wish = document.getElementById('wish-input').value;
            if(wish.trim()) showAlert("‡¶§‡ßã‡¶∞ ‡¶á‡¶ö‡ßç‡¶õ‡¶æ‡¶ü‡¶ø ‡¶¨‡ßã‡¶§‡¶≤‡ßá ‡¶≠‡¶∞‡ßá ‡¶∏‡¶æ‡¶ó‡¶∞‡ßá ‡¶≠‡¶æ‡¶∏‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡¶ø! ‡¶á‡¶®‡¶∂‡¶æ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡¶¨‡ßá‡•§ ‚ú®");
            else showAlert("‡¶â‡¶Å‡¶π‡ßÅ! ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶§‡ßã ‡¶è‡¶ï‡¶ü‡¶æ ‡¶≤‡ßá‡¶ñ‡ßã ‡¶™‡¶æ‡¶ó‡¶≤‡¶ø! üòú");
        }

        // --- Alert ---
        function showAlert(msg) {
            const box = document.getElementById('custom-alert');
            document.getElementById('alert-text').innerText = msg;
            box.classList.remove('hidden');
            setTimeout(() => document.getElementById('alert-box').style.transform = 'scale(1)', 10);
        }
        function closeAlert() {
            document.getElementById('alert-box').style.transform = 'scale(0.9)';
            setTimeout(() => {
                document.getElementById('custom-alert').classList.add('hidden');
                if(document.getElementById('scene-bottle').classList.contains('active')) nextScene('end');
            }, 200);
        }

        // --- Confetti ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const pieces = [];
            for(let i=0; i<150; i++) pieces.push({ x: canvas.width/2, y: canvas.height/2+50, w: Math.random()*10+5, h: Math.random()*10+5, c: `hsl(${Math.random()*360}, 100%, 50%)`, vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20-10 });
            function update() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                pieces.forEach(p => { p.x+=p.vx; p.y+=p.vy; p.vy+=0.2; ctx.fillStyle=p.c; ctx.fillRect(p.x,p.y,p.w,p.h); });
                requestAnimationFrame(update);
            }
            update();
        }

        // --- Timer ---
        function updateTimer() {
            const diff = new Date() - startDate;
            const days = Math.floor(diff / (1000*60*60*24));
            const hours = Math.floor((diff / (1000*60*60)) % 24);
            const min = Math.floor((diff / (1000*60)) % 60);
            const sec = Math.floor((diff / 1000) % 60);
            document.getElementById('relationship-timer').innerHTML = `${days} ‡¶¶‡¶ø‡¶® ${hours} ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ${min} ‡¶Æ‡¶ø. ${sec} ‡¶∏‡ßá.`;
        }
        setInterval(updateTimer, 1000); updateTimer();

        // --- Magic Dust ---
        function createDust(e) {
            if(Math.random() > 0.1) return;
            const d = document.createElement('div'); d.className = 'fixed w-1 h-1 bg-white rounded-full pointer-events-none z-50';
            d.style.left = e.clientX + 'px'; d.style.top = e.clientY + 'px'; d.style.boxShadow = '0 0 5px #fff';
            d.animate([{opacity:1, transform:'scale(1)'}, {opacity:0, transform:`translate(${(Math.random()-0.5)*50}px, ${(Math.random()-0.5)*50}px)`}], 1000).onfinish = () => d.remove();
            document.body.appendChild(d);
        }
        lucide.createIcons();
    </script>
</body>
</html>

